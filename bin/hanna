#!/usr/bin/env ruby -w
if ARGV.first == '-h' or ARGV.first == '--help'
  puts <<-HELP
Hanna -- a better RDoc template
Synopsis:
  hanna [options]  [file names...]
  [sudo] hanna --gem <name>
  
Example usage:

  $ hanna
  $ hanna src/
  $ hanna lib/*.rb

  $ hanna --gem hashie
  $ hanna --gem hashie -v 0.2.0
  $ hanna --gem all

Hanna passes all arguments to RDoc. See `rdoc --help`.

With the `--gem` option, Hanna generates documentation for installed gems.
When "all" is specified it will install docs for all installed gems, which
can take a long time. `hanna --gem` command should be prefixed with `sudo`
if special permissions are needed to write to the gems directory.

HELP
  exit 0
end

ENV['RDOCOPT'] = '--format hanna'

if ARGV.first == '--gems'
  warn "Aborted: The `--gems` option has been renamed to `--gem`.\nSee `hanna --help` for more info."
  exit(1)
elsif ARGV.first == '--gem'
  args = ARGV[1..-1]
  args << '--all' if args.delete('all')
  args << '--overwrite' unless args.include?('--all')
  args << '--no-ri' << '--rdoc'
  exec 'gem', 'rdoc', *args
else
  exec 'rdoc', *ARGV
end
