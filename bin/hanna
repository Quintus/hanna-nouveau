#!/usr/bin/env ruby -w
if ARGV.size == 1 and (ARGV.first == '-h' || ARGV.first == '--help')
  puts <<-HELP
Hanna -- a better RDoc template
Synopsis:
  hanna [options]  [file names...]
  [sudo] hanna --gems  [gem names...]
  
Example usage:

  hanna lib/**/*.rb

Hanna passes all arguments to RDoc. To find more about RDoc options, see
"rdoc -h". Default options are:

  -o doc --charset=UTF-8

The second form, with the "--gems" argument, serves the same purpose as
the "gem rdoc" command: it generates documentation for installed gems.
When no gem names are given, "hanna --gems" will install docs for EACH of
the gems, which can, uh, take a little while.

HELP
  exit 0
end

unless RUBY_PLATFORM =~ /(:?mswin|mingw)/
  require 'pathname'
  hanna_dir = Pathname.new(__FILE__).realpath.dirname + '../lib'
else
  # windows
  hanna_dir = File.expand_path(File.join(File.dirname(__FILE__), '..', 'lib'))
end

$:.unshift(hanna_dir) unless $:.include?(hanna_dir)

require 'rubygems'
require 'hanna/version'
Hanna::activate_rdoc_gem
require 'hanna'

options = []

options << '--format' << 'hanna'
options << '--charset=UTF-8'

if ARGV.first == '--gems'
  require 'hanna/rubygems'
  Hanna::Rubygems.document(ARGV[1..-1], options)
else
  options << '--output' << 'doc' if ARGV.grep(/^(--output|--op|-o)\b/).empty?
  options.concat ARGV

  RDoc::RDoc.new.document(options)
end
